Bootstrap: docker
From: ubuntu:20.04

%help
  This container provides a Python script and research data. To run the script:

    $ apptainer run myimage.sif  # or ./myimage.sif

  The script is found in /opt/scripts and the data is found in /opt/data.

%labels
  AUTHOR_NAME Alex Harral
  AUTHOR_EMAIL aharral@wistar.org
  VERSION 1.0


%environment
  export PATH=/opt/miniconda3/bin:${PATH}
  # set system locale
  export LC_ALL='C'

%post -c /bin/bash
  apt-get -y update && apt-get -y upgrade
  apt-get -y install wget
 
  INSTALL_SCRIPT=Miniconda3-py38_4.9.2-Linux-x86_64.sh
  wget https://repo.anaconda.com/miniconda/${INSTALL_SCRIPT}
  bash ${INSTALL_SCRIPT} -b -p /opt/miniconda3
  rm ${INSTALL_SCRIPT}
  /opt/miniconda3/bin/conda install pandas -y

  mkdir -p /opt/scripts && cd /opt/scripts
  wget https://github.com/TheWistarInstitute/wi-hpc-apptainer/blob/main/python/my_script.py

  mkdir -p /opt/data && cd /opt/data
  wget https://github.com/TheWistarInstitute/wi-hpc-apptainer/blob/main/python/my_data.csv
  
  # cleanup
  apt-get -y autoremove --purge
  apt-get -y clean

%runscript
  python /opt/scripts/myscript.py

%test
  /opt/miniconda3/bin/python --version
